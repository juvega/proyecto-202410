<div class="container mt-4">
  <div class="d-flex justify-content-between mb-3">
    <h2>Productos</h2>
    <button class="btn btn-primary" (click)="openCreateModal(createProductModal)">Agregar Producto</button>
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Imagen</th>
          <th>Código</th>
          <th>Descripción</th>
          <th>Categoría</th>
          <th>Stock</th>
          <th>PC (S/.)</th>
          <th>PV (S/.)</th>            
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products">
          <td><img [src]="product.imagen" alt="Imagen Producto" class="img-thumbnail" width="50"></td>
          <td>{{ product.codigo }}</td>
          <td>{{ product.descripcion }}</td>
          <td>{{ product.categoria }}</td>
          <td>{{ product.stock }}</td>
          <td>{{ product.precio_compra }}</td>
          <td>{{ product.precio_venta }}</td>            
          <td>
            <button class="btn btn-warning btn-sm" (click)="openEditModal(editProductModal, product)"><i class="fas fa-edit"></i></button>
            <button class="btn btn-danger btn-sm" (click)="openConfirmModal(confirmModal, product)"><i class="fas fa-trash-alt"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Create Product Modal -->
  <ng-template #createProductModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Agregar Producto</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <form>
        <div class="mb-3">
          <label for="productCode" class="form-label">Código</label>
          <input type="text" class="form-control" id="productCode" [(ngModel)]="selectedProduct.codigo" name="codigo">
        </div>
        <div class="mb-3">
          <label for="productDescription" class="form-label">Descripción</label>
          <input type="text" class="form-control" id="productDescription" [(ngModel)]="selectedProduct.descripcion" name="descripcion">
        </div>
        <div class="mb-3">
          <label for="productCategory" class="form-label">Categoría</label>
          <input type="text" class="form-control" id="productCategory" [(ngModel)]="selectedProduct.categoria" name="categoria">
        </div>
        <div class="mb-3">
          <label for="productStock" class="form-label">Stock</label>
          <input type="number" class="form-control" id="productStock" [(ngModel)]="selectedProduct.stock" name="stock">
        </div>
        <div class="mb-3">
          <label for="productPriceCompra" class="form-label">PC (S/.)</label>
          <input type="number" class="form-control" id="productPriceCompra" [(ngModel)]="selectedProduct.precio_compra" name="precio_compra">
        </div>
        <div class="mb-3">
          <label for="productPriceVenta" class="form-label">PV (S/.)</label>
          <input type="number" class="form-control" id="productPriceVenta" [(ngModel)]="selectedProduct.precio_venta" name="precio_venta">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Close click')">Cerrar</button>
      <button type="button" class="btn btn-primary" (click)="guardarNuevoProducto()">Guardar Producto</button>
    </div>
  </ng-template>

  <!-- Edit Product Modal -->
  <ng-template #editProductModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Editar Producto</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <form>
        <div class="mb-3">
          <label for="editProductCode" class="form-label">Código</label>
          <input type="text" class="form-control" id="editProductCode" [(ngModel)]="selectedProduct.codigo" name="codigo">
        </div>
        <div class="mb-3">
          <label for="editProductDescription" class="form-label">Descripción</label>
          <input type="text" class="form-control" id="editProductDescription" [(ngModel)]="selectedProduct.descripcion" name="descripcion">
        </div>
        <div class="mb-3">
          <label for="editProductCategory" class="form-label">Categoría</label>
          <input type="text" class="form-control" id="editProductCategory" [(ngModel)]="selectedProduct.categoria" name="categoria">
        </div>
        <div class="mb-3">
          <label for="editProductStock" class="form-label">Stock</label>
          <input type="number" class="form-control" id="editProductStock" [(ngModel)]="selectedProduct.stock" name="stock">
        </div>
        <div class="mb-3">
          <label for="editProductPriceCompra" class="form-label">PC (S/.)</label>
          <input type="number" class="form-control" id="editProductPriceCompra" [(ngModel)]="selectedProduct.precio_compra" name="precio_compra">
        </div>
        <div class="mb-3">
          <label for="editProductPriceVenta" class="form-label">PV (S/.)</label>
          <input type="number" class="form-control" id="editProductPriceVenta" [(ngModel)]="selectedProduct.precio_venta" name="precio_venta">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Close click')">Cerrar</button>
      <button type="button" class="btn btn-primary" (click)="guardarCambios()">Guardar cambios</button>
    </div>
  </ng-template>

  <!-- Confirm Delete Modal -->
  <ng-template #confirmModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Confirmar Eliminación</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <p>¿Desea eliminar el producto {{ selectedProduct.descripcion }}?</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Close click')">No</button>
      <button type="button" class="btn btn-danger" (click)="confirmarEliminacion()">Sí</button>
    </div>
  </ng-template>
</div>
